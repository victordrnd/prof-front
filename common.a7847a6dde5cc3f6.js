"use strict";(self.webpackChunkprof_front=self.webpackChunkprof_front||[]).push([[592],{9703:(I,_,i)=>{i.d(_,{l:()=>y});var u=i(655),o=i(5e3),v=i(325),C=i(3175),b=i(263),t=i(8669),x=i(9808);function M(r,m){if(1&r&&(o.ynx(0),o._uU(1),o.BQk()),2&r){const e=m.$implicit;o.xp6(1),o.AsE("",e.firstname," ",e.lastname,", ")}}function T(r,m){if(1&r){const e=o.EpF();o.TgZ(0,"button",9),o.NdJ("click",function(){return o.CHM(e),o.oxw(2).goToLesson()}),o._uU(1,"Afficher le cours"),o.qZA()}}function d(r,m){if(1&r&&(o.TgZ(0,"div",4)(1,"div"),o._uU(2),o.TgZ(3,"span",5),o.YNc(4,M,2,2,"ng-container",6),o.qZA()(),o.TgZ(5,"div"),o.YNc(6,T,2,0,"button",7),o._UZ(7,"nb-icon",8),o.qZA()()),2&r){const e=o.oxw();o.xp6(2),o.hij("",null==e.room?null:e.room.name," "),o.xp6(2),o.Q6J("ngForOf",null==e.room?null:e.room.users),o.xp6(2),o.Q6J("ngIf",null==e.room?null:e.room.lessonId)}}function g(r,m){if(1&r&&o._UZ(0,"nb-chat-message",10),2&r){const e=m.$implicit;o.s9C("sender",null==e.user?null:e.user.firstname),o.Q6J("type",e.type)("message",e.text)("reply",e.reply)("date",e.date)("files",e.files)("quote",e.quote)("latitude",e.latitude)("longitude",e.longitude)("avatar",null==e.user?null:e.user.avatar)}}let y=(()=>{class r{constructor(e,a,l,p){this.route=e,this.chatService=a,this.router=l,this.authService=p,this.subscriptions=[]}ngOnInit(){return(0,u.mG)(this,void 0,void 0,function*(){if(this.currentUser=this.authService.currentUserValue,console.log(this.currentUser),this.roomId)this.fetchRoom(this.roomId),this.chatService.currentRoomId=this.roomId;else{const a=this.route.params.subscribe(l=>{this.fetchRoom(l.id),this.chatService.currentRoomId=l.id});this.subscriptions.push(a)}const e=this.chatService.onNewMessage().subscribe(a=>{a.roomId==this.room.id&&(a=this.formatMessage(a),this.messages.push(a))});this.subscriptions.push(e)})}fetchRoom(e){return(0,u.mG)(this,void 0,void 0,function*(){this.room=yield this.chatService.getRoom(e).toPromise(),this.messages=yield this.chatService.getRoomMessages(e).toPromise(),this.messages=this.messages.map(a=>this.formatMessage(a)),this.chatService.clearUnReadMessageForRoom(this.room.id)})}sendMessage(e){console.log(e);let a=[];e.files.length&&(a=e.files?e.files.map(l=>({data:l,type:l.type,name:l.name})):[]),this.chatService.sendMessage({type:a.length?"file":"text",files:a,userId:this.currentUser.id,roomId:this.room.id,content:e.message})}formatMessage(e){const a=e.type;return e.type="text"!=e.type?"file":"text","file"==e.type?e.files=[{url:e.content,type:a,icon:"file-text-outline"}]:e.text=e.content,e.user=this.room.users.find(l=>l.id==e.userId),e.reply=e.userId==this.currentUser.id,e.date=e.created_at,e}goToLesson(){"teacher"==this.currentUser.role.slug?this.router.navigate([`/teacher/lessons/${this.room.lessonId}`]):"student"==this.currentUser.role.slug&&this.router.navigate([`/student/lessons/${this.room.lessonId}`])}ngOnDestroy(){this.chatService.currentRoomId=null,this.subscriptions.map(e=>e.unsubscribe())}}return r.\u0275fac=function(e){return new(e||r)(o.Y36(v.gz),o.Y36(C.a),o.Y36(v.F0),o.Y36(b.e))},r.\u0275cmp=o.Xpm({type:r,selectors:[["app-room-details"]],inputs:{roomId:"roomId"},decls:4,vars:4,consts:[[3,"scrollBottom"],["nbChatTitle",""],["dateFormat","shortTime",3,"type","message","reply","sender","date","files","quote","latitude","longitude","avatar",4,"ngFor","ngForOf"],[3,"showButton","dropFiles","send"],[1,"d-flex","justify-content-between"],[1,"text-grey","ml-2","text-small"],[4,"ngFor","ngForOf"],["nbButton","","size","small","class","mx-3",3,"click",4,"ngIf"],["icon","phone-call",1,"text-primary","pointer","font-bold"],["nbButton","","size","small",1,"mx-3",3,"click"],["dateFormat","shortTime",3,"type","message","reply","sender","date","files","quote","latitude","longitude","avatar"]],template:function(e,a){1&e&&(o.TgZ(0,"nb-chat",0),o.YNc(1,d,8,3,"ng-template",1),o.YNc(2,g,1,10,"nb-chat-message",2),o.TgZ(3,"nb-chat-form",3),o.NdJ("send",function(p){return a.sendMessage(p)}),o.qZA()()),2&e&&(o.Q6J("scrollBottom",!0),o.xp6(2),o.Q6J("ngForOf",a.messages),o.xp6(1),o.Q6J("showButton",!0)("dropFiles",!0))},directives:[t.vTO,t.YYs,x.sg,x.O5,t.DPz,t.fMN,t.ksC,t.iMi],styles:["[_nghost-%COMP%]  time{font-size:9px}[_nghost-%COMP%]  .scrollable{min-height:80vh;max-height:80vh;background:#f8f9fb}[_nghost-%COMP%]  .header{background:#f8f9fb!important;box-shadow:0 5px 15px #00000014}[_nghost-%COMP%]  nb-chat-message.reply nb-chat-message-text .text{background-color:#fff}[_nghost-%COMP%]  .text-small{font-size:12px}"]}),r})()},6024:(I,_,i)=>{i.r(_),i.d(_,{TchatModule:()=>D});var u=i(9808),o=i(325),v=i(8574),C=i(9703),b=i(655),t=i(5e3),x=i(3175),M=i(1069),T=i(9470),d=i(4573),g=i(4219),y=i(685),r=i(8669),m=i(5737),e=i(3713);function a(s,c){1&s&&t._UZ(0,"nz-empty")}function l(s,c){if(1&s&&(t._UZ(0,"nb-user",12),t.ALo(1,"date")),2&s){const n=t.oxw().$implicit;t.s9C("name",n.name),t.hYB("title","",null==n.last_message?null:n.last_message.content," \xb7 ",t.xi3(1,4,n.updated_at,"shortTime"),""),t.Q6J("picture",n.image)}}function p(s,c){if(1&s&&(t._UZ(0,"nb-user",13),t.ALo(1,"date")),2&s){const n=t.oxw().$implicit;t.s9C("name",n.name),t.hYB("title","",null==n.last_message?null:n.last_message.content," \xb7 ",t.xi3(1,4,n.updated_at,"shortTime"),""),t.Q6J("picture",n.image)}}function R(s,c){if(1&s&&(t.TgZ(0,"li",8)(1,"div",9),t.YNc(2,l,2,7,"nb-user",10),t.YNc(3,p,2,7,"nb-user",11),t.qZA(),t._UZ(4,"span"),t.qZA()),2&s){const n=c.$implicit;t.MGl("routerLink","room/",n.id,""),t.xp6(2),t.Q6J("ngIf",n.new_message),t.xp6(1),t.Q6J("ngIf",!n.new_message)}}function z(s,c){if(1&s&&(t.TgZ(0,"div",14),t._UZ(1,"ng-lottie",15),t.TgZ(2,"h2",16),t._uU(3,"Messagerie instantan\xe9e"),t.qZA()()),2&s){const n=t.oxw();t.xp6(1),t.Q6J("options",n.options)}}let P=(()=>{class s{constructor(n,h,O){this.chatService=n,this.cache=h,this.router=O,this.options={path:"/assets/animations/education.json"},this.mobile=!1,this.subscriptions=[],this.home=!0}ngOnInit(){return(0,b.mG)(this,void 0,void 0,function*(){(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))&&(this.mobile=!0),this.home="/messages"==this.router.url;const n=this.router.events.subscribe(f=>{f instanceof o.m2&&(this.home="/messages"==f.url)});this.chatService.clearUnReadMessage(),yield this.chatService.connect(),yield this.chatService.getMyRooms(),this.rooms=this.chatService.rooms.value;const h=this.chatService.rooms.subscribe(f=>{this.rooms=f}),O=this.chatService.socket.fromEvent("new_room").subscribe(f=>(0,b.mG)(this,void 0,void 0,function*(){this.cache.delete("rooms"),yield this.chatService.connect(!0),this.chatService.getMyRooms()}));this.subscriptions.push(O,h,n),this.rooms.length&&this.goToRoom(this.rooms[0].id)})}goToRoom(n){this.router.navigate(["/messages/room/"+n])}ngOnDestroy(){this.subscriptions.map(n=>n.unsubscribe())}}return s.\u0275fac=function(n){return new(n||s)(t.Y36(x.a),t.Y36(M.Hg),t.Y36(o.F0))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-tchat"]],decls:13,vars:6,consts:[[1,"layout"],[3,"nzCollapsed","nzWidth","nzCollapsedWidth"],["nz-menu","","nzMode","inline",1,"w-100","max-dimension"],[4,"ngIf"],["class","mt-0 py-4","nz-menu-item","",3,"routerLink",4,"ngFor","ngForOf"],[2,"overflow","auto","max-height","calc(100vh - 74px)"],[1,"body"],["class","w-50 d-block mx-auto",4,"ngIf"],["nz-menu-item","",1,"mt-0","py-4",3,"routerLink"],[1,"d-flex","py-3"],["badgeText","1","badgeStatus","primary","badgePosition","bottom right","class","mx-2","shape","semi-round",3,"picture","name","title",4,"ngIf"],["class","mx-2","shape","semi-round",3,"picture","name","title",4,"ngIf"],["badgeText","1","badgeStatus","primary","badgePosition","bottom right","shape","semi-round",1,"mx-2",3,"picture","name","title"],["shape","semi-round",1,"mx-2",3,"picture","name","title"],[1,"w-50","d-block","mx-auto"],[3,"options"],[1,"text-center","text-grey"]],template:function(n,h){1&n&&(t._UZ(0,"app-header"),t.TgZ(1,"nz-layout",0)(2,"nz-sider",1)(3,"ul",2),t.YNc(4,a,1,0,"nz-empty",3),t.YNc(5,R,5,3,"li",4),t._UZ(6,"nz-divider"),t.qZA()(),t.TgZ(7,"nz-content",5)(8,"div",6)(9,"nb-layout")(10,"nb-layout-column"),t.YNc(11,z,4,1,"div",7),t._UZ(12,"router-outlet"),t.qZA()()()()()),2&n&&(t.xp6(2),t.Q6J("nzCollapsed",!!h.mobile)("nzWidth",390)("nzCollapsedWidth",h.mobile?0:80),t.xp6(2),t.Q6J("ngIf",0==(null==h.rooms?null:h.rooms.length)),t.xp6(1),t.Q6J("ngForOf",h.rooms),t.xp6(6),t.Q6J("ngIf",h.home))},directives:[T.G,d.hw,d.t7,g.wO,u.O5,y.p9,u.sg,g.r9,o.rH,r.k0$,m.g,d.OK,r.Aqw,r.dP_,e.e$,o.lC],pipes:[u.uU],styles:[".body[_ngcontent-%COMP%]{background-color:#f8f9fb}html[_ngcontent-%COMP%]{overflow-y:hidden}.mx-05[_ngcontent-%COMP%]{margin-right:.5rem;margin-left:.5rem}.pb-05[_ngcontent-%COMP%]{padding-bottom:.5rem}li[_ngcontent-%COMP%]{outline:0}[nz-menu][_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]  .user-title{font-size:10px!important}[_nghost-%COMP%]  .anticon{transform:translateY(0)!important}[_nghost-%COMP%]  .ant-layout-sider-zero-width-trigger{background-color:#45aca0}[_nghost-%COMP%]  .ant-layout-sider-zero-width-trigger:hover{background:#e7e1ff}[_nghost-%COMP%]  .ant-layout-sider-trigger{background-color:#45aca0}[_nghost-%COMP%]  .ant-layout-header{padding:0!important;height:74px}[_nghost-%COMP%]  .ant-layout-content{background-color:#f8f9fb}[_nghost-%COMP%]  .ant-layout-sider{background:white!important;min-height:calc(100vh - 74px)}[_nghost-%COMP%]  .max-dimension{max-height:calc(100vh - 74px);overflow:auto}[_nghost-%COMP%]  .ant-menu-inline>.ant-menu-item{height:64px;line-height:55px}[_nghost-%COMP%]  .ant-menu-inline .ant-menu-item:not(:last-child){margin-bottom:0!important}[_nghost-%COMP%]  .anticon-bars{transform:translateY(-6px)}[_nghost-%COMP%]  .ant-table-tbody td{padding:12px 11px!important}[_nghost-%COMP%]  .ant-table-thead th{padding:12px 11px!important}"]}),s})();const A=[{path:"",component:P,canActivate:[v.P],children:[{path:"room/:id",component:C.l}]}];let U=(()=>{class s{}return s.\u0275fac=function(n){return new(n||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[o.Bz.forChild(A)],o.Bz]}),s})();var Z=i(7175);let D=(()=>{class s{}return s.\u0275fac=function(n){return new(n||s)},s.\u0275mod=t.oAB({type:s,bootstrap:[P]}),s.\u0275inj=t.cJS({imports:[[u.ez,U,d.wm,g.ip,Z.m,r.BW0,r.AE1,m.S,r.e6k,r.jSo,r.KdK,r.T2N,y.Xo,e.CT]]}),s})()}}]);